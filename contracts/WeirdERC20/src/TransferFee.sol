// Copyright (C) 2020 d-xo
// SPDX-License-Identifier: AGPL-3.0-only

pragma solidity ^0.8.13;

import { ERC20 } from "./ERC20.sol";

contract TransferFeeToken is ERC20 {
  uint256 immutable fee;

  // --- Init ---
  constructor(uint256 _totalSupply, uint256 _fee) public ERC20(_totalSupply) {
    fee = _fee;
  }

  // --- Token ---
  function transferFrom(
    address src,
    address dst,
    uint256 wad
  ) public override returns (bool) {
    require(balanceOf[src] >= wad, "insufficient-balance");
    if (src != msg.sender && allowance[src][msg.sender] != type(uint256).max) {
      require(allowance[src][msg.sender] >= wad, "insufficient-allowance");
      allowance[src][msg.sender] = sub(allowance[src][msg.sender], wad);
    }

    balanceOf[src] = sub(balanceOf[src], wad);
    balanceOf[dst] = add(balanceOf[dst], sub(wad, fee));
    balanceOf[address(0)] = add(balanceOf[address(0)], fee);

    emit Transfer(src, dst, sub(wad, fee));
    emit Transfer(src, address(0), fee);

    return true;
  }
}
